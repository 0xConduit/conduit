// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

/// @notice The type of the oracle
/// There are two types of oracles: TEE and ZKP
enum OracleType {
    TEE,
    ZKP
}

/// @notice The access proof which is a signature signed by the receiver (the receiver may delegate the signing privilege to the access assistant)
/// @param dataHash The hash of the data
/// @param targetPubkey The target receiver's public key, the field in access proof is for compatibility with different public encryption schemes, if it's empty, it means the receiver's ethereum public key
/// @param nonce The nonce of the access proof
/// @param proof The proof
struct AccessProof {
    bytes32 dataHash;
    bytes targetPubkey;
    bytes nonce;
    bytes proof;
}

/// @notice The ownership proof which is a signature signed by the receiver (the receiver may delegate the signing privilege to the access assistant)
/// @param proofType The type of the proof
/// @param dataHash The hash of the data
/// @param sealedKey The sealed key of the new data key
/// @param targetPubkey The target receiver's public key
/// @param nonce The nonce
struct OwnershipProof {
    OracleType oracleType;
    bytes32 dataHash;
    bytes sealedKey;
    bytes targetPubkey;
    bytes nonce;
    bytes proof;
}

struct TransferValidityProof {
    AccessProof accessProof;
    OwnershipProof ownershipProof;
}

/// @notice The output of the transfer validity proof
/// @param dataHash The hash of the data
/// @param sealedKey The sealed key of the new data key
/// @param targetPubkey The target receiver's public key from the ownership proof
/// @param wantedKey The target receiver's public key from the access proof, if it's empty, it means the receiver's ethereum public key
/// @param accessAssistant The access assistant
/// @param accessProofNonce The nonce of the access proof
/// @param ownershipProofNonce The nonce of the ownership proof
struct TransferValidityProofOutput {
    bytes32 dataHash;
    bytes sealedKey;
    bytes targetPubkey;
    bytes wantedKey;
    address accessAssistant;
    bytes accessProofNonce;
    bytes ownershipProofNonce;
}

interface IERC7857DataVerifier {
    /// @notice Verify data transfer validity, the proofs prove:
    ///         1. The dataHash identified data is available to the target receiver
    ///         2. The dataHash identified data is owned by the sender
    ///         3. The dataHash identified data is decrypted by the data key, and the decrypted plaintext is good
    ///         4. The data key which is used to encrypt the dataHash identified data is delivered to the target receiver
    /// @param proofs Proof generated by TEE/ZKP
    function verifyTransferValidity(TransferValidityProof[] calldata proofs)
        external
        returns (TransferValidityProofOutput[] memory);
}
